# Buffer Package Example
Julian Winternheimer  
10/30/2016  

## Installation
Use the `devtools` package to install the package from Github.


```r
# install.packages("devtools")
devtools::install_github("jwinternheimer/buffer")
```

Great! Now load the package into your R session.


```r
library(buffer)
```

## Connecting to Redshift
Use the `redshift_connect()` function to connect to Redshift. You will need to set your credentials as environment variables first, if you haven't already.


```r
# Sys.setenv(BUFFER_REDSHIFT_USER = "xxxxxxxxx")
# Sys.setenv(BUFFER_REDSHIFT_PWD = "xxxxxxxxx")

con <- redshift_connect()
```

```
## [1] "Your Redshift credentials are set in your .Renviron file. You're all good."
```

### Query Redshift tables
You can also use the `query_db()` function to query the database directly.


```r
users <- query_db("select user_id, billing_plan from users limit 100", con)
head(users)
```

```
##                    user_id billing_plan
## 1 000000000000000000000011      awesome
## 2 000000000000000000002496      awesome
## 3 000000000000000000002662      awesome
## 4 000000000000000000004732      awesome
## 5 000000000000000000007750      awesome
## 6 000000000000000000010544      awesome
```

### Write data into Redshift
This could be very helpful to write model results back into Redshift, but we will just use some dummy data in this particular example. Use caution with this one! In addition, the process is slow, especially for lots of data. The function creates a new table and "batches" the dataframe and writes it in incrementally with a `INSERT INTO` statement.


```r
# Generate dunny data
num_columns <- 1e2L
num_rows <- 1e3L 
df <- as.data.frame(replicate(num_columns, runif(num_rows)))

# Write dummy data to Redshift
insert_batch(con, "buffer_test_table_delete", df)

# Query new table
sample_data <- query_db("select * from buffer_test_table_delete limit 20", con)
head(sample_data)
```

```
##           v1        v2         v3        v4        v5          v6
## 1 0.26525029 0.3768082 0.44244770 0.1403093 0.9249014 0.219409312
## 2 0.06521203 0.5461678 0.16826248 0.9575628 0.9555149 0.003765878
## 3 0.94122403 0.8434206 0.07561906 0.1153472 0.7817250 0.653941214
## 4 0.14656831 0.5985287 0.98336019 0.7792690 0.6209469 0.047847290
## 5 0.89316680 0.6438384 0.68535260 0.1925148 0.0793374 0.372052773
## 6 0.46468008 0.1487677 0.35932305 0.3903289 0.7217537 0.562101037
##          v7        v8         v9        v10       v11        v12
## 1 0.4959452 0.3805775 0.92529100 0.69696740 0.7859409 0.44607724
## 2 0.1924703 0.6123968 0.82401850 0.75645412 0.5615899 0.99398828
## 3 0.3660622 0.7871851 0.90359646 0.76635714 0.8620173 0.68762042
## 4 0.5369137 0.3420862 0.02771086 0.24115882 0.4644636 0.92717045
## 5 0.2989422 0.1251597 0.89075513 0.60258388 0.4315212 0.32099889
## 6 0.0516127 0.9710358 0.04499960 0.01875495 0.9900396 0.07906601
##          v13       v14        v15         v16        v17        v18
## 1 0.81287699 0.2555320 0.20201316 0.193946838 0.01783089 0.74828453
## 2 0.50313980 0.7707355 0.86092382 0.728463727 0.13953404 0.54870430
## 3 0.01442656 0.7851913 0.02768997 0.785884003 0.65272522 0.78280016
## 4 0.97944762 0.8612095 0.37162119 0.651446932 0.37360905 0.91350467
## 5 0.52195809 0.9080218 0.74285489 0.618515975 0.98936636 0.06396134
## 6 0.06114852 0.5776241 0.58956144 0.009455543 0.73377747 0.73082692
##          v19       v20       v21        v22        v23       v24
## 1 0.27460705 0.3670632 0.7559126 0.62347731 0.60959024 0.4618547
## 2 0.37635448 0.7742824 0.8012310 0.27836952 0.36040092 0.8883699
## 3 0.40527240 0.5976019 0.6214128 0.40812668 0.69574007 0.2448983
## 4 0.84272471 0.9744196 0.5655623 0.05448123 0.05757869 0.0426704
## 5 0.02017485 0.1251171 0.4769362 0.27792022 0.49730950 0.3426950
## 6 0.95997893 0.4791859 0.1571977 0.27221782 0.29177319 0.2861625
##          v25        v26        v27        v28       v29        v30
## 1 0.80767404 0.07189642 0.75759699 0.10216991 0.8994037 0.41142647
## 2 0.73861513 0.11485897 0.97997618 0.07274445 0.2806496 0.51201106
## 3 0.76566221 0.49811303 0.43048412 0.82512045 0.2775189 0.32338597
## 4 0.20942385 0.75701063 0.82068665 0.85586284 0.9484168 0.48392041
## 5 0.60038007 0.15321129 0.07385618 0.13153757 0.7124758 0.05520962
## 6 0.02580012 0.31657314 0.63710206 0.71915861 0.6637786 0.56274714
##         v31        v32       v33        v34       v35        v36       v37
## 1 0.1653300 0.95282295 0.8248934 0.70657500 0.1966873 0.14831842 0.5269446
## 2 0.8758479 0.52797350 0.6020590 0.17855591 0.1146610 0.21577968 0.8167582
## 3 0.7683673 0.43091035 0.6314103 0.87529491 0.5052670 0.16729419 0.5241546
## 4 0.8693632 0.44297492 0.5040720 0.55070229 0.2061091 0.97388111 0.3658383
## 5 0.8247126 0.82256843 0.2287394 0.16775341 0.1917535 0.43076715 0.7427224
## 6 0.6993510 0.07848612 0.2238532 0.06994348 0.4257868 0.02704339 0.8477697
##          v38       v39         v40       v41        v42       v43
## 1 0.20893776 0.2718621 0.852760330 0.8915257 0.03080125 0.1297355
## 2 0.02843076 0.5263298 0.619867196 0.2803693 0.25187868 0.8828543
## 3 0.06116677 0.9328726 0.347729425 0.5851867 0.28499419 0.2517743
## 4 0.13711868 0.3635035 0.009358449 0.4138905 0.81191424 0.6098972
## 5 0.82522737 0.7368065 0.794705204 0.2210286 0.21075967 0.7338754
## 6 0.72022914 0.3819561 0.815069091 0.2417232 0.84446755 0.3858565
##         v44       v45        v46        v47       v48       v49        v50
## 1 0.2986146 0.7638283 0.88472783 0.15985202 0.3784889 0.8473124 0.30654192
## 2 0.6548752 0.5950879 0.64551127 0.44412688 0.9811257 0.4883449 0.69869776
## 3 0.6034144 0.5016155 0.48904376 0.05784890 0.9768769 0.2116642 0.48039550
## 4 0.8228282 0.9641594 0.13420575 0.05923699 0.9082443 0.7638239 0.71556204
## 5 0.1011520 0.2451764 0.99253791 0.98481701 0.9278556 0.7482459 0.03302796
## 6 0.7292704 0.8132309 0.01014797 0.31246752 0.7069891 0.3336540 0.95266686
##          v51        v52       v53        v54       v55       v56
## 1 0.88959149 0.15122347 0.3351448 0.60384466 0.5780127 0.9429212
## 2 0.47656523 0.11425420 0.7705091 0.06176193 0.4383411 0.1943331
## 3 0.61252665 0.35477211 0.7679941 0.38911976 0.6598491 0.5962551
## 4 0.47703060 0.77756833 0.1973272 0.60544801 0.4958220 0.1152644
## 5 0.03145485 0.09181138 0.8105831 0.76729058 0.2905564 0.6216970
## 6 0.08757604 0.25460905 0.2508564 0.05304892 0.4530786 0.1019030
##          v57       v58        v59       v60       v61       v62        v63
## 1 0.99206055 0.8685543 0.43016013 0.2395461 0.5352643 0.1093212 0.74600933
## 2 0.36578520 0.6427947 0.62053286 0.5622728 0.8743980 0.4349457 0.80619359
## 3 0.66202056 0.6037033 0.09755376 0.9835082 0.3170999 0.1168272 0.79633974
## 4 0.31223428 0.6764810 0.41151186 0.9049452 0.2434578 0.8920009 0.21737019
## 5 0.12536879 0.1625278 0.44882062 0.6893964 0.1459668 0.4249066 0.08296297
## 6 0.07412618 0.8968479 0.69656107 0.2010753 0.7711244 0.4978353 0.03444466
##          v64       v65       v66       v67       v68       v69        v70
## 1 0.83805288 0.2243613 0.1193295 0.9711495 0.8299739 0.4344778 0.71663857
## 2 0.87483944 0.6449369 0.9079179 0.4096918 0.6889131 0.1069210 0.07539182
## 3 0.09794971 0.4742563 0.6167277 0.9602794 0.2735169 0.6394825 0.99180235
## 4 0.23904086 0.3957835 0.3747509 0.9938455 0.4171811 0.8570005 0.24698233
## 5 0.71422251 0.4812736 0.2217578 0.3816437 0.6036847 0.9969414 0.35351926
## 6 0.97968229 0.6408260 0.8704644 0.6570685 0.8042638 0.5247947 0.65876655
##          v71       v72        v73        v74       v75       v76       v77
## 1 0.45317623 0.9299193 0.51650106 0.39901425 0.6714838 0.1416130 0.5141682
## 2 0.61996360 0.4788896 0.30770197 0.42664724 0.8403501 0.2427248 0.3113787
## 3 0.40162389 0.8614573 0.05160125 0.09125386 0.8838379 0.1616048 0.4395923
## 4 0.33006500 0.3770421 0.60040619 0.13805902 0.6916379 0.7478452 0.5425534
## 5 0.41084361 0.4858426 0.51375912 0.36752912 0.6341226 0.1728033 0.2610794
## 6 0.08544898 0.8701904 0.69287460 0.97577317 0.5765029 0.2263317 0.4504622
##         v78        v79        v80        v81         v82       v83
## 1 0.3384233 0.14453913 0.20421140 0.08734274 0.414735615 0.4363026
## 2 0.7975335 0.35912809 0.63277364 0.44571907 0.963934180 0.7118860
## 3 0.7407361 0.32755684 0.63927181 0.97910562 0.219773609 0.1470419
## 4 0.2255145 0.48030193 0.05982189 0.09809895 0.693548304 0.2667057
## 5 0.3577672 0.36664753 0.10069812 0.94679148 0.006683579 0.7539419
## 6 0.9285711 0.09774959 0.12268842 0.99660871 0.802097107 0.7085168
##         v84        v85        v86         v87       v88        v89
## 1 0.7355644 0.90406016 0.27391932 0.223599302 0.3147923 0.07567131
## 2 0.8862358 0.63831803 0.81429488 0.004698297 0.1078797 0.43745723
## 3 0.6173765 0.97791703 0.03340681 0.432111425 0.9863633 0.36916008
## 4 0.3783694 0.02320906 0.47760148 0.344786982 0.6683213 0.21422322
## 5 0.9585839 0.49685593 0.83767636 0.186524741 0.8124512 0.02038101
## 6 0.5768038 0.18387630 0.03173766 0.485140346 0.3958359 0.69770880
##          v90        v91        v92        v93        v94       v95
## 1 0.60044122 0.63048019 0.89867055 0.96103386 0.11753592 0.6629748
## 2 0.93304880 0.98485983 0.01978167 0.26327650 0.32751358 0.4400840
## 3 0.08905816 0.04150035 0.45479953 0.20238145 0.10014457 0.5494293
## 4 0.10440218 0.14043510 0.11439913 0.08850211 0.64464634 0.7528709
## 5 0.75797219 0.64108603 0.47674270 0.81742454 0.06548178 0.7800582
## 6 0.65481753 0.42666841 0.61875003 0.95341829 0.71229559 0.9935936
##          v96       v97        v98        v99      v100
## 1 0.76114098 0.1738709 0.51138659 0.57462011 0.3466928
## 2 0.14170977 0.4675035 0.01748126 0.14779734 0.3166338
## 3 0.07002392 0.9683749 0.32640268 0.90112459 0.4462365
## 4 0.93293250 0.1423224 0.92600556 0.90884393 0.5061866
## 5 0.06001109 0.1910764 0.87759877 0.30081790 0.5144607
## 6 0.52187049 0.7231983 0.40438283 0.04811542 0.9939273
```

Now let's delete that dummy table. :)


```r
query_db("drop table buffer_test_table_delete", con)
```

```
## NULL
```

## Get data from Looker
The `get_look` function returns data in the form of a data frame, given a `look_id`.


```r
look_id <- 2528
looker_data <- get_look(look_id)
```

```
## [1] "Your Looker credentials are set in your .Renviron file. You're all good."
```

```r
head(looker_data)
```

```
##   Stripe.and.Apple.Mrr.By.Plan.Daily.Day.Date
## 1                                  2016-10-29
## 2                                  2016-10-29
## 3                                  2016-10-29
## 4                                  2016-10-29
## 5                                  2016-10-29
## 6                                  2016-10-29
##   Stripe.and.Apple.Mrr.By.Plan.Daily.Plan.ID
## 1                               enterprise30
## 2                 business_v2_agency_monthly
## 3                   Respond-starter-annual-1
## 4                             premium-annual
## 5                          Respond-Medium-v2
## 6                      iOS_SBusiness1MonthV2
##   Stripe.and.Apple.Mrr.By.Plan.Daily.Total.Mrr
## 1                                       600.00
## 2                                      9177.00
## 3                                         9.50
## 4                                       168.30
## 5                                       249.00
## 6                                      6613.06
```

