---
title: "Buffer Package Example"
author: "Julian Winternheimer"
date: "10/30/2016"
output: 
  html_document: 
    keep_md: yes
---

## Installation
Use the `devtools` package to install the package from Github.

```{r results='hide'}
# install.packages("devtools")
devtools::install_github("jwinternheimer/buffer")
```

Great! Now load the package into your R session.

```{r results='hide'}
library(buffer)
```

## Connecting to Redshift
Use the `redshift_connect()` function to connect to Redshift. You will need to set your credentials as environment variables first, if you haven't already.

```{r}
# Sys.setenv(BUFFER_REDSHIFT_USER = "xxxxxxxxx")
# Sys.setenv(BUFFER_REDSHIFT_PWD = "xxxxxxxxx")

con <- redshift_connect()
```

### Query Redshift tables
You can also use the `query_db()` function to query the database directly.

```{r}
users <- query_db("select user_id, billing_plan from users limit 100", con)
users
```

### Write data into Redshift
This could be very helpful to write model results back into Redshift, but we will just use some dummy data in this particular example. Use caution with this one! In addition, the process is slow, especially for lots of data. The function creates a new table and "batches" the dataframe and writes it in incrementally with a `INSERT INTO` statement.

```{r}
# Generate dunny data
num_columns <- 1e2L
num_rows <- 1e3L 
df <- as.data.frame(replicate(num_columns, runif(num_rows)))

# Write dummy data to Redshift
insert_batch(con, "buffer_test_table_delete", df)

# Query new table
query_db("select * from buffer_test_table_delete limit 20", con)
```


